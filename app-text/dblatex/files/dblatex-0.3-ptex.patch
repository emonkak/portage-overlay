diff -Pur dblatex-0.3.orig/latex/style/dbk_biblio.sty dblatex-0.3/latex/style/dbk_biblio.sty
--- dblatex-0.3.orig/latex/style/dbk_biblio.sty	2010-04-05 09:07:53.000000000 +0900
+++ dblatex-0.3/latex/style/dbk_biblio.sty	2010-12-20 13:51:05.330419996 +0900
@@ -1,4 +1,4 @@
-\usepackage{bibtopic}
+\usepackage[defaultbib]{bibtopic}
 
 % btPrintAll redefined to not include a file
 
diff -Pur dblatex-0.3.orig/latex/style/dbk_headfoot.sty dblatex-0.3/latex/style/dbk_headfoot.sty
--- dblatex-0.3.orig/latex/style/dbk_headfoot.sty	2010-04-05 09:07:53.000000000 +0900
+++ dblatex-0.3/latex/style/dbk_headfoot.sty	2010-12-20 13:58:40.198420078 +0900
@@ -16,59 +16,22 @@
 
 % Define front/main/back matter if not available
 \@ifundefined{frontmatter}{
-  \def\frontmatter{\cleardoublepage\pagenumbering{roman}\chead[]{\DBKcheadfront}}
+  \def\frontmatter{\cleardoublepage\pagenumbering{roman}}
 }{}
 \@ifundefined{mainmatter}{
-  \def\mainmatter{\cleardoublepage\pagenumbering{arabic}\chead[]{\DBKcheadbody}}
+  \def\mainmatter{\cleardoublepage\pagenumbering{arabic}}
 }{}
 \@ifundefined{backmatter}{
   \def\backmatter{\if@openright\cleardoublepage\else\clearpage\fi}
 }{}
 
 
-% Fancy header/footer for the first page
+% Fancy header/footer
 
-\chead[]{%
-  \begin{tabular}{
-    >{\raggedright}p{5.6cm} >{\centering}p{5.6cm} >{\raggedleft}p{5.6cm}} %
-    \multirow{3}{5.6cm}{\DBKtitle}
-    & & \tabularnewline%
-    & \releasebox
-    & \textsf{\thepage} \tabularnewline %
-    & & \tabularnewline%
-  \end{tabular}%
-} %
+\lhead[]{\DBKtitle}
+\rhead[]{\textsf{\thepage}}
+\chead[]{}
 
 \lfoot[]{\@ifundefined{DBKpublisher}{}{\DBKpublisher}}
 \rfoot[]{}
 \cfoot[]{}
-
-% Fancy header/footer for the front matter
-
-\def\DBKcheadfront{%
-  \begin{tabular}{
-    >{\raggedright}p{5.6cm} >{\centering}p{5.6cm} >{\raggedleft}p{5.6cm}} %
-    \multirow{3}{5.6cm}{\DBKtitle}
-    & & \textsf{\DBKreference{} \edhead} \tabularnewline%
-    & \releasebox & \tabularnewline %
-    & & \textsf{\thepage}
-  \tabularnewline%
-  \end{tabular}%
-}
-
-% Fancy header/footer for the doc body
-
-\def\DBKcheadbody{%
-  \begin{tabular}{
-    >{\raggedright}p{5.6cm} >{\centering}p{5.6cm} >{\raggedleft}p{5.6cm}} %
-    \multirow{3}{5.6cm}{\DBKtitle}
-    & & \textsf{\DBKreference{} \edhead} \tabularnewline%
-    & \releasebox & \tabularnewline %
-    & & \textsf{\thepage{} / \getpagerefnumber{LastPage}}
-  \tabularnewline%
-  \end{tabular}%
-}
-
-\lhead[]{}
-\rhead[]{}
-
diff -Pur dblatex-0.3.orig/latex/style/dbk_hyper.sty dblatex-0.3/latex/style/dbk_hyper.sty
--- dblatex-0.3.orig/latex/style/dbk_hyper.sty	2010-04-05 09:07:53.000000000 +0900
+++ dblatex-0.3/latex/style/dbk_hyper.sty	2010-12-20 13:51:05.331420009 +0900
@@ -20,7 +20,7 @@
     \usepackage[xetex,plainpages=false,\hyperparam,\hyperparamadd]{hyperref}
     \def\hyperlabel#1{\hypertarget{#1}{}}
   \else
-    \usepackage[dvips,plainpages=false,\hyperparam,\hyperparamadd]{hyperref}
+    \usepackage[dvipdfm,plainpages=false,\hyperparam,\hyperparamadd]{hyperref}
     \def\hyperlabel#1{\Hy@raisedlink{\hyper@anchorstart{#1}\hyper@anchorend}}
   \fi\fi
 }{
diff -Pur dblatex-0.3.orig/latex/style/docbook.sty dblatex-0.3/latex/style/docbook.sty
--- dblatex-0.3.orig/latex/style/docbook.sty	2010-04-05 09:07:53.000000000 +0900
+++ dblatex-0.3/latex/style/docbook.sty	2010-12-20 13:59:13.255420009 +0900
@@ -92,23 +92,6 @@
 \def\showwatermark#1{}%
 \fi
 
-% ##############################################################################
-% ### Page Parameters
-% ##############################################################################
-\setlength{\paperwidth}{21cm}
-\setlength{\paperheight}{29.7cm}
-\setlength{\hoffset}{-1in}
-\setlength{\voffset}{-1in}
-\setlength{\oddsidemargin}{2cm}
-\setlength{\marginparsep}{0cm}
-\setlength{\marginparwidth}{0cm}
-\setlength{\textwidth}{18cm}
-\setlength{\topmargin}{0.5cm}
-\setlength{\headsep}{2cm}
-
-\setlength{\textheight}{24cm}
-\setlength{\footskip}{1.5cm}
-
 
 % ##############################################################################
 % ### Used Packages
diff -Pur dblatex-0.3.orig/lib/dbtexmf/core/imagedata.py dblatex-0.3/lib/dbtexmf/core/imagedata.py
--- dblatex-0.3.orig/lib/dbtexmf/core/imagedata.py	2010-04-05 09:07:53.000000000 +0900
+++ dblatex-0.3/lib/dbtexmf/core/imagedata.py	2010-12-20 13:51:05.331420009 +0900
@@ -114,6 +114,11 @@
             conv = EpsConverter()
         elif (ext in ("gif", "bmp")):
             conv = GifConverter()
+        elif (ext in ("jpg", "jpeg", "png")):
+            # Extract bounding box
+            cmd = "ebb %s" % realfig
+            self.system(cmd)
+            return realfig
         else:
             # Unknown conversion to do, or nothing to do
             return self._safe_file(fig, realfig, ext)
diff -Pur dblatex-0.3.orig/lib/dbtexmf/dblatex/grubber/dvipdfmx.py dblatex-0.3/lib/dbtexmf/dblatex/grubber/dvipdfmx.py
--- dblatex-0.3.orig/lib/dbtexmf/dblatex/grubber/dvipdfmx.py	1970-01-01 09:00:00.000000000 +0900
+++ dblatex-0.3/lib/dbtexmf/dblatex/grubber/dvipdfmx.py	2010-12-20 13:51:05.331420009 +0900
@@ -0,0 +1,53 @@
+# This file is part of Rubber and thus covered by the GPL
+# (c) Emmanuel Beffara, 2002--2006
+"""
+PDF generation through dvipdfmx with Rubber.
+"""
+
+import sys
+import os
+from os.path import *
+import subprocess
+
+from msg import _ , msg
+from plugins import TexModule
+from maker import Depend
+
+class Dep (Depend):
+    def __init__ (self, doc, target, source, node):
+        self.doc = doc
+        self.env = doc.env
+        self.source = source
+        self.target = target
+        Depend.__init__(self, doc.env, prods=[target], sources={source: node})
+        self.options = []
+        self.cmdexec = "dvipdfmx"
+
+    def run (self):
+        cmd = [self.cmdexec]
+        msg.progress(_("running %s on %s") % (cmd[0], self.source))
+        for opt in self.doc.paper.split():
+            cmd.extend(["-p", opt])
+        cmd.extend(self.options + ["-o", self.target, self.source])
+        msg.debug(" ".join(cmd))
+        rc = subprocess.call(cmd)
+        if rc != 0:
+            msg.error(_("%s failed on %s") % (cmd[0], self.source))
+            return 1
+        return 0
+
+class Module (TexModule):
+    def __init__ (self, doc, dict):
+        self.doc = doc
+        lastdep = doc.env.dep_last()
+        dvi = lastdep.prods[0]
+        root, ext = os.path.splitext(dvi)
+        if ext != ".dvi":
+            msg.error(_("I can't use dvipdfmx when not producing a DVI"))
+            sys.exit(2)
+        pdf = root + ".pdf"
+        self.dep = Dep(doc, pdf, dvi, lastdep)
+        doc.env.dep_append(self.dep)
+
+    def do_options (self, *args):
+        self.dep.options.extend(args)
diff -Pur dblatex-0.3.orig/lib/dbtexmf/dblatex/grubber/dvips.py dblatex-0.3/lib/dbtexmf/dblatex/grubber/dvips.py
--- dblatex-0.3.orig/lib/dbtexmf/dblatex/grubber/dvips.py	2010-04-05 09:07:53.000000000 +0900
+++ dblatex-0.3/lib/dbtexmf/dblatex/grubber/dvips.py	2010-12-20 13:51:05.332420017 +0900
@@ -28,7 +28,7 @@
         if self.doc.engine == "Omega":
             self.cmdexec = "odvips"
         else:
-            self.cmdexec = "dvips"
+            self.cmdexec = "pdvips"
             self.options.append("-R0")
 
     def run (self):
diff -Pur dblatex-0.3.orig/lib/dbtexmf/dblatex/grubber/latex.py dblatex-0.3/lib/dbtexmf/dblatex/grubber/latex.py
--- dblatex-0.3.orig/lib/dbtexmf/dblatex/grubber/latex.py	2010-04-05 09:07:53.000000000 +0900
+++ dblatex-0.3/lib/dbtexmf/dblatex/grubber/latex.py	2010-12-20 13:51:05.332420017 +0900
@@ -27,7 +27,7 @@
         self.srcfile = None
         self.srcbase = None
         self.outfile = None
-        self.program = "latex"
+        self.program = "platex"
         self.engine = "TeX"
         self.paper = ""
         self.prods = []
@@ -43,7 +43,7 @@
         self.draft_only = False
         self.draft_support = False
         self.batch = 1
-        self.opts = []
+        self.opts = ['-kanji=utf8']
 
     def reinit(self):
         # Restart with a clean module set, parser and logger
diff -Pur dblatex-0.3.orig/lib/dbtexmf/dblatex/grubber/texbuilder.py dblatex-0.3/lib/dbtexmf/dblatex/grubber/texbuilder.py
--- dblatex-0.3.orig/lib/dbtexmf/dblatex/grubber/texbuilder.py	2010-04-05 09:07:53.000000000 +0900
+++ dblatex-0.3/lib/dbtexmf/dblatex/grubber/texbuilder.py	2010-12-20 13:54:11.694420043 +0900
@@ -25,7 +25,7 @@
         self.maker.dep_append(self.tex)
 
         # What to do
-        self.backend = "pdftex"
+        self.backend = "dvipdfmx"
         self.format = "pdf"
         self.index_style = ""
         self.batch = 1
@@ -53,6 +53,8 @@
                 self.tex.modules.register("pdftex")
             elif (self.backend == "xetex"):
                 self.tex.modules.register("xetex")
+            elif (self.backend == "dvipdfmx"):
+                self.tex.modules.register("dvipdfmx")
             else:
                 self.tex.modules.register("dvips")
                 self.tex.modules.register("ps2pdf")
diff -Pur dblatex-0.3.orig/lib/dbtexmf/dblatex/runtex.py dblatex-0.3/lib/dbtexmf/dblatex/runtex.py
--- dblatex-0.3.orig/lib/dbtexmf/dblatex/runtex.py	2010-04-05 09:07:53.000000000 +0900
+++ dblatex-0.3/lib/dbtexmf/dblatex/runtex.py	2010-12-20 13:54:13.906420117 +0900
@@ -12,7 +12,7 @@
     def __init__(self):
         self.fig_paths = []
         self.index_style = ""
-        self.backend = "pdftex"
+        self.backend = "dvipdfmx"
         self.texpost = ""
         self.texer = LatexBuilder()
 
@@ -26,7 +26,7 @@
         paths_input = []
         for p in paths:
             if p.find(" ") != -1:
-                paths_blank.append(p + "//")
+                paths_blank.append(p + "/")
             else:
                 paths_input.append(p)
 
@@ -54,7 +54,7 @@
                                                    [os.getenv("BSTINPUTS", "")])
 
     def set_backend(self, backend):
-        if not(backend in ("dvips", "pdftex", "xetex")):
+        if not(backend in ("dvipdfmx", "dvips", "pdftex", "xetex")):
             raise ValueError("'%s': invalid backend" % backend)
         self.backend = backend
 
@@ -84,7 +84,7 @@
         # The temporary file contains the extra paths
         f = file(tmptex, "w")
         if self.fig_paths:
-            paths = "{" + "//}{".join(self.fig_paths) + "//}"
+            paths = "{" + "/}{".join(self.fig_paths) + "/}"
             f.write("\\makeatletter\n")
             f.write("\\def\\input@path{%s}\n" % paths)
             f.write("\\makeatother\n")
diff -Pur dblatex-0.3.orig/scripts/dblatex dblatex-0.3/scripts/dblatex
--- dblatex-0.3.orig/scripts/dblatex	2010-04-05 09:07:53.000000000 +0900
+++ dblatex-0.3/scripts/dblatex	2010-12-20 14:02:57.894420011 +0900
@@ -2,7 +2,7 @@
 import sys
 import os
 
-package_base = os.path.join(os.path.dirname(sys.argv[0]), "..")
+package_base = '/usr/share/dblatex'
 sys.path.append(os.path.realpath(os.path.join(package_base, "lib")))
 
 from dbtexmf.dblatex import dblatex
diff -Pur dblatex-0.3.orig/xsl/lang.xsl dblatex-0.3/xsl/lang.xsl
--- dblatex-0.3.orig/xsl/lang.xsl	2010-04-05 09:07:53.000000000 +0900
+++ dblatex-0.3/xsl/lang.xsl	2010-12-09 16:29:58.875000000 +0900
@@ -47,13 +47,6 @@
     </xsl:call-template>
   </xsl:variable>
 
-  <!-- locale setup for docbook -->
-  <xsl:if test="$lang!='' and $lang!='en'">
-    <xsl:text>\setuplocale{</xsl:text>
-    <xsl:value-of select="substring($lang, 1, 2)"/>
-    <xsl:text>}&#10;</xsl:text>
-  </xsl:if>
-
   <!-- some extra babel setup -->
   <xsl:if test="$latex.babel.use='1'">
     <xsl:variable name="babel">
@@ -129,24 +122,9 @@
 
 
 <xsl:template name="lang.document.begin">
-  <xsl:param name="lang"/>
-  <xsl:if test="starts-with($lang,'zh') or
-                starts-with($lang,'ja') or
-                (starts-with($lang,'ko') and $korean.package='CJK')">
-    <xsl:text>\begin{CJK}{UTF8}{</xsl:text>
-    <xsl:value-of select="$cjk.font"/>
-    <xsl:text>}&#10;</xsl:text>
-  </xsl:if>
 </xsl:template>
 
 <xsl:template name="lang.document.end">
-  <xsl:param name="lang"/>
-  <xsl:if test="starts-with($lang,'zh') or
-                starts-with($lang,'ja') or
-                (starts-with($lang,'ko') and $korean.package='CJK')">
-    <xsl:text>\clearpage&#10;</xsl:text>
-    <xsl:text>\end{CJK}&#10;</xsl:text>
-  </xsl:if>
 </xsl:template>
 
 <!-- #############
